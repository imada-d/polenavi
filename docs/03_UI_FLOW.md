# UI画面遷移・フロー

## モバイルとPCの違い

### モバイル版
- フルスクリーン表示
- 画面遷移あり（複数画面）
- カメラ撮影機能
- タッチ操作

### PC版
- 右パネル（400px固定幅）
- 1画面完結（パネル内で全て完了）
- ドラッグ&ドロップでファイル選択
- マウス操作

**重要**: モバイルとPCはファイルを完全に分離
```
frontend/src/pages/
├── mobile/    # モバイル専用
└── pc/        # PC専用
```

---

## 登録フロー（モバイル版）

### 1. 地図画面（Home）
```
┌─────────────────────────┐
│ PoleNavi     📍 [🔔]    │
├─────────────────────────┤
│                          │
│    地図エリア            │
│    📍(25) 📍(18)        │
│                          │
│   [⚡ クイック登録]      │
├─────────────────────────┤
│ [🗺️] [🔍] [📊] [📸] [🏆]│
└─────────────────────────┘
```

**[⚡ クイック登録]ボタンをタップ**
↓

### 2. 位置確認画面（RegisterPoleInfo）
```
┌─────────────────────────┐
│ [←] 位置を確認          │
├─────────────────────────┤
│                          │
│    地図エリア            │
│       📍                 │
│    （ピンをドラッグ）    │
│                          │
├─────────────────────────┤
│ 📍 緯度: 32.849066       │
│ 📍 経度: 130.781983      │
│                          │
│ ⚠️ 近くに既存の電柱あり  │
│ 📍 2m先に登録済み        │
│                          │
│ [これは別の電柱です]     │
│ [同じ電柱です]           │
│                          │
│ [次へ：柱の種類選択]     │
└─────────────────────────┘
```

**ユーザーが選択**:
- 別の電柱 → 新規登録へ
- 同じ電柱 → 既存の電柱に番号追加へ

**[次へ]ボタンをタップ**
↓

### 3. 柱の種類選択（RegisterPoleInfo）
```
┌─────────────────────────┐
│ [←] 柱の種類を選択      │
├─────────────────────────┤
│                          │
│ ◉ 電柱                   │
│ ○ その他                 │
│                          │
│ [次へ：詳細選択]         │
└─────────────────────────┘
```

**「電柱」を選択した場合**
↓ 事業者選択へ

**「その他」を選択した場合**
↓ その他の詳細選択へ

---

### 3-1. 事業者選択（電柱の場合）
```
┌─────────────────────────┐
│ [←] 事業者を選択        │
├─────────────────────────┤
│                          │
│ ○ 電力会社               │
│ ○ NTT                    │
│ ○ その他                 │
│                          │
│ [次へ：番号札枚数確認]   │
└─────────────────────────┘
```

**補足**: 
- 「電力会社」を選択した場合、都道府県から自動判定
- 例: 熊本県 → 九州電力
- 例: 愛知県 → 中部電力

---

### 3-2. その他の詳細選択（その他の場合）
```
┌─────────────────────────┐
│ [←] 種類を選択          │
├─────────────────────────┤
│                          │
│ ○ 照明柱                 │
│ ○ 標識柱                 │
│ ○ 信号柱                 │
│ ○ その他                 │
│                          │
│ [次へ：番号札枚数確認]   │
└─────────────────────────┘
```

↓

### 4. 番号札枚数確認（RegisterPoleInfo）
```
┌─────────────────────────┐
│ [←] 番号札の枚数        │
├─────────────────────────┤
│                          │
│ この柱に番号札は何枚     │
│ ありますか？             │
│                          │
│ ◉ 1枚                    │
│ ○ 2枚                    │
│ ○ 3枚以上                │
│ ○ 0枚（番号なし）        │
│                          │
│ [次へ：写真撮影]         │
└─────────────────────────┘
```

**0枚を選択した場合**
- 自動生成番号（例: 熊本市-照明柱-001）
- 写真撮影画面へ（番号札写真なし）

**1枚以上を選択した場合**
- 写真撮影画面へ

↓

### 5. 写真撮影（まとめて撮影）
```
┌─────────────────────────┐
│ [←] 写真を撮影          │
├─────────────────────────┤
│                          │
│ 📸 まとめて撮影してね！  │
│                          │
│ 撮影済み: 3枚            │
│                          │
│ [📷 写真を撮る]          │
│                          │
│ サムネイル表示:          │
│ [IMG1] [IMG2] [IMG3]     │
│                          │
│ [次へ：写真を分類]       │
└─────────────────────────┘
```

↓

### 6. 写真分類画面（RegisterPhotoClassify）
```
┌─────────────────────────┐
│ [←] 写真を分類          │
├─────────────────────────┤
│                          │
│ 📸 写真1                 │
│ [大きな画像プレビュー]   │
│                          │
│ この写真の種類は？       │
│ ◉ 番号札                 │
│ ○ 全体写真               │
│ ○ 詳細写真               │
│                          │
│ [次の写真へ] (1/3)       │
└─────────────────────────┘
```

**全ての写真を分類完了**
↓

### 7. 番号入力画面（RegisterNumberInput）

#### 7-1. 番号札が1枚の場合
```
┌─────────────────────────┐
│ [←] 番号を入力          │
├─────────────────────────┤
│                          │
│ 📸 番号札写真            │
│ [画像プレビュー]         │
│                          │
│ ✍️ 電柱番号を入力        │
│                          │
│ ┌─────────────────────┐│
│ │ 247エ714            ││
│ └─────────────────────┘│
│                          │
│ 💡 前回: 247エ713        │
│    連続入力モード        │
│                          │
│ [次へ：メモ入力]         │
└─────────────────────────┘
```

#### 7-2. 番号札が複数枚の場合
```
┌─────────────────────────┐
│ [←] 番号を入力 (1/2)    │
├─────────────────────────┤
│                          │
│ 📸 番号札写真1           │
│ [画像プレビュー]         │
│                          │
│ ✍️ 電柱番号を入力        │
│                          │
│ ┌─────────────────────┐│
│ │ 247エ714            ││
│ └─────────────────────┘│
│                          │
│ [次の番号へ]             │
└─────────────────────────┘
```

↓

### 8. メモ・ハッシュタグ入力画面
```
┌─────────────────────────┐
│ [←] メモを入力（任意）  │
├─────────────────────────┤
│                          │
│ 🏷️ ハッシュタグ          │
│ ┌─────────────────────┐│
│ │ #防犯灯 #LED        ││
│ └─────────────────────┘│
│                          │
│ 📝 メモ                  │
│ ┌─────────────────────┐│
│ │ 2025/09/30 交換済み ││
│ │ 管理番号: 123       ││
│ └─────────────────────┘│
│                          │
│ [スキップ] [次へ：確認]  │
└─────────────────────────┘
```

↓

### 9. 登録確認画面
```
┌─────────────────────────┐
│ [←] 登録内容を確認      │
├─────────────────────────┤
│                          │
│ 📍 位置: 32.849066,      │
│         130.781983       │
│                          │
│ 🏷️ 種類: 電柱            │
│                          │
│ 🔢 番号: 247エ714        │
│                          │
│ 📸 写真: 3枚             │
│                          │
│ 📝 メモ: あり            │
│                          │
│ [修正する] [登録する]    │
└─────────────────────────┘
```

**[登録する]ボタンをタップ**
↓

### 10. 登録完了画面
```
┌─────────────────────────┐
│      登録完了！🎉        │
├─────────────────────────┤
│                          │
│ ✅ 電柱を登録しました    │
│                          │
│ 🎁 獲得ポイント: +10pt   │
│                          │
│ 📊 累計登録数: 15本      │
│                          │
│ [地図に戻る]             │
│ [続けて登録する]         │
└─────────────────────────┘
```

---

## 登録フロー（PC版）

### 右パネルで全て完結

```
┌──────────────┬─────────────────────┐
│              │ [×] 電柱を登録      │
│              ├─────────────────────┤
│              │                     │
│   地図       │ 📍 位置を確認       │
│   エリア     │ 緯度: 32.849066     │
│              │ 経度: 130.781983    │
│   📍         │                     │
│   (ピン)     │ [位置を調整]        │
│              │                     │
│              │ 🏷️ 種類を選択       │
│              │ ◉ 電柱 ○ その他     │
│              │                     │
│              │ 📋 事業者（電柱のみ）│
│              │ ◉ 電力会社          │
│              │ ○ NTT ○ その他      │
│              │                     │
│              │ 📸 写真をアップロード│
│              │ [ドラッグ&ドロップ] │
│              │                     │
│              │ 🔢 番号を入力       │
│              │ [247エ714]          │
│              │                     │
│              │ 📝 メモ（任意）     │
│              │ [メモ入力欄]        │
│              │                     │
│              │ [登録する]          │
└──────────────┴─────────────────────┘
```

**特徴**:
- スクロールで全項目を表示
- 画面遷移なし
- ドラッグ&ドロップで写真追加
- マウスで位置調整

---

## 検索機能

### 統一検索画面
```
┌─────────────────────────┐
│ [←] 検索                │
├─────────────────────────┤
│                          │
│ 🔍 検索                  │
│ ┌─────────────────────┐│
│ │ 247エ714            ││
│ └─────────────────────┘│
│                          │
│ 🔽 フィルター            │
│                          │
│ 種類:                    │
│ ☑️ 電柱                  │
│ ☑️ 照明柱                │
│ ☑️ 標識柱                │
│                          │
│ 事業者:                  │
│ ☑️ 電力会社              │
│ ☑️ NTT                   │
│ ☑️ その他                │
│                          │
│ ハッシュタグ:            │
│ [#防犯灯] [#LED]         │
│                          │
│ [検索実行]               │
└─────────────────────────┘
```

---

## ボトムナビゲーション（モバイル版）

```
┌─────────────────────────┐
│ [🗺️] [🔍] [📊] [📸] [🏆]│
└─────────────────────────┘
```

- **🗺️ 地図**: トップ画面
- **🔍 検索**: 番号/ハッシュタグ検索
- **📊 統計**: 地域別統計
- **📸 ギャラリー**: 写真一覧・ランキング
- **🏆 ランキング**: ユーザーランキング

---

## 連続登録機能

### 前回の値を引き継ぎ

```
前回: 247エ713（九州電力）
今回: 247エ714 ← 自動で+1

連続登録モード:
  1. 事業者を引き継ぎ
  2. 番号の前半（247エ）を引き継ぎ
  3. 末尾の数字だけ+1
  4. ユーザーが確認・修正可能
```

---

## エラーハンドリング

### 位置情報取得エラー
```
┌─────────────────────────┐
│ ⚠️ 位置情報を取得できま  │
│    せんでした            │
│                          │
│ 設定から位置情報の許可を │
│ ONにしてください         │
│                          │
│ [設定を開く] [手動で入力]│
└─────────────────────────┘
```

### 写真アップロードエラー
```
┌─────────────────────────┐
│ ❌ 画像が大きすぎます    │
│                          │
│ 現在: 8.2MB              │
│ 上限: 5MB                │
│                          │
│ 💡 ヒント:               │
│ カメラアプリの設定で画質 │
│ を下げるか、別の写真を   │
│ 選んでください           │
│                          │
│ [OK]                     │
└─────────────────────────┘
```

---

## レスポンシブ対応

### 画面幅による切り替え

```javascript
// 768px未満: モバイル版
if (window.innerWidth < 768) {
  // モバイル用コンポーネント
  <RegisterPoleInfo />
  <RegisterPhotoClassify />
  <RegisterNumberInput />
}

// 768px以上: PC版
else {
  // PC用コンポーネント
  <Home> {/* 地図 */}
    <RegisterPanel /> {/* 右パネル */}
  </Home>
}
```

---

## 画面遷移図（モバイル版）

```
Home（地図）
  ↓ [クイック登録]
RegisterPoleInfo（位置確認 → 種類選択 → 番号札枚数）
  ↓
写真撮影（まとめて撮影）
  ↓
RegisterPhotoClassify（写真分類）
  ↓
RegisterNumberInput（番号入力）
  ↓
メモ・ハッシュタグ入力
  ↓
登録確認
  ↓
登録完了
  ↓
Home（地図）に戻る or 続けて登録
```

---

## 重要な設計判断

### なぜモバイルとPCを分離したのか
1. UI構造が全く違う（フルスクリーン vs 右パネル）
2. 操作方法が違う（タッチ vs マウス）
3. 写真取得方法が違う（カメラ撮影 vs ファイル選択）
4. 共通化すると条件分岐だらけで保守性が低下

### なぜ写真を「まとめて撮影 → 後で分類」にしたのか
1. ユーザーは撮影に集中できる
2. 分類は後で落ち着いてできる
3. 撮影ミスを防ぐ（全体像を見てから分類）

### なぜ番号札枚数を先に聞くのか
1. 写真の分類がスムーズ
2. 必要な番号入力欄の数がわかる
3. ユーザーの認識と一致